"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getParticipants = exports.iterParticipants = exports._ParticipantsIter = void 0;
const Helpers_1 = require("../Helpers");
const requestIter_1 = require("../requestIter");
const __1 = require("../");
const tl_1 = require("../tl");
const big_integer_1 = __importDefault(require("big-integer"));
const util_1 = require("util");
const _MAX_PARTICIPANTS_CHUNK_SIZE = 200;
const _MAX_ADMIN_LOG_CHUNK_SIZE = 100;
const _MAX_PROFILE_PHOTO_CHUNK_SIZE = 100;
class _ChatAction {
    constructor(client, chat, action, params = {
        delay: 4,
        autoCancel: true,
    }) {
        this._client = client;
        this._chat = chat;
        this._action = action;
        this._delay = params.delay;
        this.autoCancel = params.autoCancel;
        this._request = undefined;
        this._task = null;
        this._running = false;
    }
    [util_1.inspect.custom]() {
        return Helpers_1.betterConsoleLog(this);
    }
    start() {
        return __awaiter(this, void 0, void 0, function* () {
            this._request = new tl_1.Api.messages.SetTyping({
                peer: this._chat,
                action: this._action,
            });
            this._running = true;
            this._update();
        });
    }
    stop() {
        return __awaiter(this, void 0, void 0, function* () {
            this._running = false;
            if (this.autoCancel) {
                yield this._client.invoke(new tl_1.Api.messages.SetTyping({
                    peer: this._chat,
                    action: new tl_1.Api.SendMessageCancelAction(),
                }));
            }
        });
    }
    _update() {
        return __awaiter(this, void 0, void 0, function* () {
            while (this._running) {
                if (this._request != undefined) {
                    yield this._client.invoke(this._request);
                }
                yield Helpers_1.sleep(this._delay * 1000);
            }
        });
    }
    progress(current, total) {
        if ("progress" in this._action) {
            this._action.progress = 100 * Math.round(current / total);
        }
    }
}
_ChatAction._str_mapping = {
    typing: new tl_1.Api.SendMessageTypingAction(),
    contact: new tl_1.Api.SendMessageChooseContactAction(),
    game: new tl_1.Api.SendMessageGamePlayAction(),
    location: new tl_1.Api.SendMessageGeoLocationAction(),
    "record-audio": new tl_1.Api.SendMessageRecordAudioAction(),
    "record-voice": new tl_1.Api.SendMessageRecordAudioAction(),
    "record-round": new tl_1.Api.SendMessageRecordRoundAction(),
    "record-video": new tl_1.Api.SendMessageRecordVideoAction(),
    audio: new tl_1.Api.SendMessageUploadAudioAction({ progress: 1 }),
    voice: new tl_1.Api.SendMessageUploadAudioAction({ progress: 1 }),
    song: new tl_1.Api.SendMessageUploadAudioAction({ progress: 1 }),
    round: new tl_1.Api.SendMessageUploadRoundAction({ progress: 1 }),
    video: new tl_1.Api.SendMessageUploadVideoAction({ progress: 1 }),
    photo: new tl_1.Api.SendMessageUploadPhotoAction({ progress: 1 }),
    document: new tl_1.Api.SendMessageUploadDocumentAction({ progress: 1 }),
    file: new tl_1.Api.SendMessageUploadDocumentAction({ progress: 1 }),
    cancel: new tl_1.Api.SendMessageCancelAction(),
};
class _ParticipantsIter extends requestIter_1.RequestIter {
    [util_1.inspect.custom]() {
        return Helpers_1.betterConsoleLog(this);
    }
    _init({ entity, filter, search, }) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (filter && filter.constructor === Function) {
                if ([
                    tl_1.Api.ChannelParticipantsBanned,
                    tl_1.Api.ChannelParticipantsKicked,
                    tl_1.Api.ChannelParticipantsSearch,
                    tl_1.Api.ChannelParticipantsContacts,
                ].includes(filter)) {
                    filter = new filter({
                        q: "",
                    });
                }
                else {
                    filter = new filter();
                }
            }
            entity = yield this.client.getInputEntity(entity);
            const ty = __1.helpers._entityType(entity);
            if (search && (filter || ty != __1.helpers._EntityType.CHANNEL)) {
                // We need to 'search' ourselves unless we have a PeerChannel
                search = search.toLowerCase();
                this.filterEntity = (entity) => {
                    return (__1.utils
                        .getDisplayName(entity)
                        .toLowerCase()
                        .includes(search) ||
                        ("username" in entity ? entity.username || "" : "")
                            .toLowerCase()
                            .includes(search));
                };
            }
            else {
                this.filterEntity = (entity) => true;
            }
            // Only used for channels, but we should always set the attribute
            this.requests = [];
            if (ty == __1.helpers._EntityType.CHANNEL) {
                const channel = yield this.client.invoke(new tl_1.Api.channels.GetFullChannel({
                    channel: entity,
                }));
                if (!(channel.fullChat instanceof tl_1.Api.ChatFull)) {
                    this.total = channel.fullChat.participantsCount;
                }
                if (this.total && this.total <= 0) {
                    return false;
                }
                this.requests.push(new tl_1.Api.channels.GetParticipants({
                    channel: entity,
                    filter: filter ||
                        new tl_1.Api.ChannelParticipantsSearch({
                            q: search || "",
                        }),
                    offset: 0,
                    limit: _MAX_PARTICIPANTS_CHUNK_SIZE,
                    hash: 0,
                }));
            }
            else if (ty == __1.helpers._EntityType.CHAT) {
                if (!("chatId" in entity)) {
                    throw new Error("Found chat without id " + JSON.stringify(entity));
                }
                const full = yield this.client.invoke(new tl_1.Api.messages.GetFullChat({
                    chatId: entity.chatId,
                }));
                if (full.fullChat instanceof tl_1.Api.ChatFull) {
                    if (!(full.fullChat.participants instanceof
                        tl_1.Api.ChatParticipantsForbidden)) {
                        this.total = full.fullChat.participants.participants.length;
                    }
                    else {
                        this.total = 0;
                        return false;
                    }
                    const users = new Map();
                    for (const user of full.users) {
                        users.set(user.id, user);
                    }
                    for (const participant of full.fullChat.participants
                        .participants) {
                        const user = users.get(participant.userId);
                        if (!this.filterEntity(user)) {
                            continue;
                        }
                        user.participant = participant;
                        (_a = this.buffer) === null || _a === void 0 ? void 0 : _a.push(user);
                    }
                    return true;
                }
            }
            else {
                this.total = 1;
                if (this.limit != 0) {
                    const user = yield this.client.getEntity(entity);
                    if (this.filterEntity(user)) {
                        // @ts-ignore
                        user.participant = null;
                        (_b = this.buffer) === null || _b === void 0 ? void 0 : _b.push(user);
                    }
                }
                return true;
            }
        });
    }
    _loadNextChunk() {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (!((_a = this.requests) === null || _a === void 0 ? void 0 : _a.length)) {
                return true;
            }
            this.requests[0].limit = Math.min(this.limit - this.requests[0].offset, _MAX_PARTICIPANTS_CHUNK_SIZE);
            if (this.requests[0].offset > this.limit) {
                return true;
            }
            const results = [];
            for (const request of this.requests) {
                results.push(yield this.client.invoke(request));
            }
            for (let i = this.requests.length - 1; i >= 0; i--) {
                const participants = results[i];
                if (participants instanceof
                    tl_1.Api.channels.ChannelParticipantsNotModified ||
                    !participants.users.length) {
                    this.requests.splice(i, 1);
                    continue;
                }
                this.requests[i].offset += participants.participants.length;
                const users = new Map();
                for (const user of participants.users) {
                    users.set(user.id, user);
                }
                for (const participant of participants.participants) {
                    if (!("userId" in participant)) {
                        continue;
                    }
                    const user = users.get(participant.userId);
                    if (this.filterEntity && !this.filterEntity(user)) {
                        continue;
                    }
                    user.participant = participant;
                    (_b = this.buffer) === null || _b === void 0 ? void 0 : _b.push(user);
                }
            }
            return undefined;
        });
    }
    [Symbol.asyncIterator]() {
        return super[Symbol.asyncIterator]();
    }
}
exports._ParticipantsIter = _ParticipantsIter;
class _AdminLogIter extends requestIter_1.RequestIter {
    [util_1.inspect.custom]() {
        return Helpers_1.betterConsoleLog(this);
    }
    _init(entity, searchArgs, filterArgs) {
        return __awaiter(this, void 0, void 0, function* () {
            let eventsFilter = undefined;
            if (filterArgs &&
                Object.values(filterArgs).find((element) => element === true)) {
                eventsFilter = new tl_1.Api.ChannelAdminLogEventsFilter(Object.assign({}, filterArgs));
            }
            this.entity = yield this.client.getInputEntity(entity);
            const adminList = [];
            if (searchArgs && searchArgs.admins) {
                for (const admin of searchArgs.admins) {
                    adminList.push(yield this.client.getInputEntity(admin));
                }
            }
            this.request = new tl_1.Api.channels.GetAdminLog({
                channel: this.entity,
                q: (searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.search) || "",
                minId: searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.minId,
                maxId: searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.maxId,
                limit: 0,
                eventsFilter: eventsFilter,
                admins: adminList || undefined,
            });
        });
    }
    _loadNextChunk() {
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.request) {
                return true;
            }
            this.request.limit = Math.min(this.left, _MAX_ADMIN_LOG_CHUNK_SIZE);
            const r = yield this.client.invoke(this.request);
            const entities = new Map();
            for (const entity of [...r.users, ...r.chats]) {
                entities.set(__1.utils.getPeerId(entity), entity);
            }
            const eventIds = [];
            for (const e of r.events) {
                eventIds.push(e.id);
            }
            this.request.maxId = Helpers_1.getMinBigInt([big_integer_1.default.zero, ...eventIds]);
            for (const ev of r.events) {
                if (ev.action instanceof tl_1.Api.ChannelAdminLogEventActionEditMessage) {
                    // @ts-ignore
                    // TODO ev.action.prevMessage._finishInit(this.client, entities, this.entity);
                    // @ts-ignore
                    // TODO ev.action.newMessage._finishInit(this.client, entities, this.entity);
                }
            }
        });
    }
}
/** @hidden */
function iterParticipants(client, entity, { limit, search, filter }) {
    return new _ParticipantsIter(client, limit !== null && limit !== void 0 ? limit : Number.MAX_SAFE_INTEGER, {}, {
        entity: entity,
        filter: filter,
        search: search,
    });
}
exports.iterParticipants = iterParticipants;
/** @hidden */
function getParticipants(client, entity, params) {
    return __awaiter(this, void 0, void 0, function* () {
        const it = client.iterParticipants(entity, params);
        return (yield it.collect());
    });
}
exports.getParticipants = getParticipants;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9ncmFtanMvY2xpZW50L2NoYXRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUVBLHdDQUE4RTtBQUM5RSxnREFBNkM7QUFDN0MsMkJBQXFDO0FBQ3JDLDhCQUE0QjtBQUM1Qiw4REFBaUQ7QUFDakQsK0JBQStCO0FBRS9CLE1BQU0sNEJBQTRCLEdBQUcsR0FBRyxDQUFDO0FBQ3pDLE1BQU0seUJBQXlCLEdBQUcsR0FBRyxDQUFDO0FBQ3RDLE1BQU0sNkJBQTZCLEdBQUcsR0FBRyxDQUFDO0FBTzFDLE1BQU0sV0FBVztJQXNDYixZQUNJLE1BQXNCLEVBQ3RCLElBQWdCLEVBQ2hCLE1BQWdELEVBQ2hELFNBQThCO1FBQzFCLEtBQUssRUFBRSxDQUFDO1FBQ1IsVUFBVSxFQUFFLElBQUk7S0FDbkI7UUFFRCxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDM0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO1FBQzFCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQzFCLENBQUM7SUFyQkQsQ0FBQyxjQUFPLENBQUMsTUFBTSxDQUFDO1FBQ1osT0FBTywwQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBcUJLLEtBQUs7O1lBQ1AsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFFBQUcsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN2QyxJQUFJ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