"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.doAuthentication = void 0;
/**
 * Executes the authentication process with the Telegram servers.
 * @param sender a connected {MTProtoPlainSender}.
 * @param log
 * @returns {Promise<{authKey: *, timeOffset: *}>}
 */
const tl_1 = require("../tl");
const errors_1 = require("../errors");
const Factorizator_1 = require("../crypto/Factorizator");
const IGE_1 = require("../crypto/IGE");
const extensions_1 = require("../extensions");
const AuthKey_1 = require("../crypto/AuthKey");
const __1 = require("../");
const RSA_1 = require("../crypto/RSA");
const big_integer_1 = __importDefault(require("big-integer"));
function doAuthentication(sender, log) {
    return __awaiter(this, void 0, void 0, function* () {
        // Step 1 sending: PQ Request, endianness doesn't matter since it's random
        let bytes = __1.helpers.generateRandomBytes(16);
        const nonce = __1.helpers.readBigIntFromBuffer(bytes, false, true);
        const resPQ = yield sender.send(new tl_1.Api.ReqPqMulti({ nonce: nonce }));
        log.debug("Starting authKey generation step 1");
        if (!(resPQ instanceof tl_1.Api.ResPQ)) {
            throw new Error(`Step 1 answer was ${resPQ}`);
        }
        if (resPQ.nonce.neq(nonce)) {
            throw new errors_1.SecurityError("Step 1 invalid nonce from server");
        }
        const pq = __1.helpers.readBigIntFromBuffer(resPQ.pq, false, true);
        log.debug("Finished authKey generation step 1");
        log.debug("Starting authKey generation step 2");
        // Step 2 sending: DH Exchange
        let { p, q } = Factorizator_1.Factorizator.factorize(pq);
        const pBuffer = __1.helpers.getByteArray(p);
        const qBuffer = __1.helpers.getByteArray(q);
        bytes = __1.helpers.generateRandomBytes(32);
        const newNonce = __1.helpers.readBigIntFromBuffer(bytes, true, true);
        const pqInnerData = new tl_1.Api.PQInnerData({
            pq: __1.helpers.getByteArray(pq),
            p: pBuffer,
            q: qBuffer,
            nonce: resPQ.nonce,
            serverNonce: resPQ.serverNonce,
            newNonce: newNonce,
        });
        // sha_digest + data + random_bytes
        let cipherText = undefined;
        let targetFingerprint = undefined;
        for (const fingerprint of resPQ.serverPublicKeyFingerprints) {
            cipherText = yield RSA_1.encrypt(fingerprint, pqInnerData.getBytes());
            if (cipherText !== undefined) {
                targetFingerprint = fingerprint;
                break;
            }
        }
        if (cipherText === undefined) {
            throw new errors_1.SecurityError("Step 2 could not find a valid key for fingerprints");
        }
        const serverDhParams = yield sender.send(new tl_1.Api.ReqDHParams({
            nonce: resPQ.nonce,
            serverNonce: resPQ.serverNonce,
            p: pBuffer,
            q: qBuffer,
            publicKeyFingerprint: targetFingerprint,
            encryptedData: cipherText,
        }));
        if (!(serverDhParams instanceof tl_1.Api.ServerDHParamsOk ||
            serverDhParams instanceof tl_1.Api.ServerDHParamsFail)) {
            throw new Error(`Step 2.1 answer was ${serverDhParams}`);
        }
        if (serverDhParams.nonce.neq(resPQ.nonce)) {
            throw new errors_1.SecurityError("Step 2 invalid nonce from server");
        }
        if (serverDhParams.serverNonce.neq(resPQ.serverNonce)) {
            throw new errors_1.SecurityError("Step 2 invalid server nonce from server");
        }
        if (serverDhParams instanceof tl_1.Api.ServerDHParamsFail) {
            const sh = yield __1.helpers.sha1(__1.helpers.toSignedLittleBuffer(newNonce, 32).slice(4, 20));
            const nnh = __1.helpers.readBigIntFromBuffer(sh, true, true);
            if (serverDhParams.newNonceHash.neq(nnh)) {
                throw new errors_1.SecurityError("Step 2 invalid DH fail nonce from server");
            }
        }
        if (!(serverDhParams instanceof tl_1.Api.ServerDHParamsOk)) {
            throw new Error(`Step 2.2 answer was ${serverDhParams}`);
        }
        log.debug("Finished authKey generation step 2");
        log.debug("Starting authKey generation step 3");
        // Step 3 sending: Complete DH Exchange
        const { key, iv } = yield __1.helpers.generateKeyDataFromNonce(resPQ.serverNonce, newNonce);
        if (serverDhParams.encryptedAnswer.length % 16 !== 0) {
            // See PR#453
            throw new errors_1.SecurityError("Step 3 AES block size mismatch");
        }
        const ige = new IGE_1.IGE(key, iv);
        const plainTextAnswer = ige.decryptIge(serverDhParams.encryptedAnswer);
        const reader = new extensions_1.BinaryReader(plainTextAnswer);
        reader.read(20); // hash sum
        const serverDhInner = reader.tgReadObject();
        if (!(serverDhInner instanceof tl_1.Api.ServerDHInnerData)) {
            throw new Error(`Step 3 answer was ${serverDhInner}`);
        }
        if (serverDhInner.nonce.neq(resPQ.nonce)) {
            throw new errors_1.SecurityError("Step 3 Invalid nonce in encrypted answer");
        }
        if (serverDhInner.serverNonce.neq(resPQ.serverNonce)) {
            throw new errors_1.SecurityError("Step 3 Invalid server nonce in encrypted answer");
        }
        const dhPrime = __1.helpers.readBigIntFromBuffer(serverDhInner.dhPrime, false, false);
        const ga = __1.helpers.readBigIntFromBuffer(serverDhInner.gA, false, false);
        const timeOffset = serverDhInner.serverTime - Math.floor(new Date().getTime() / 1000);
        const b = __1.helpers.readBigIntFromBuffer(__1.helpers.generateRandomBytes(256), false, false);
        const gb = __1.helpers.modExp(big_integer_1.default(serverDhInner.g), b, dhPrime);
        const gab = __1.helpers.modExp(ga, b, dhPrime);
        // Prepare client DH Inner Data
        const clientDhInner = new tl_1.Api.ClientDHInnerData({
            nonce: resPQ.nonce,
            serverNonce: resPQ.serverNonce,
            retryId: big_integer_1.default.zero,
            gB: __1.helpers.getByteArray(gb, false),
        }).getBytes();
        const clientDdhInnerHashed = Buffer.concat([
            yield __1.helpers.sha1(clientDhInner),
            clientDhInner,
        ]);
        // Encryption
        const clientDhEncrypted = ige.encryptIge(clientDdhInnerHashed);
        const dhGen = yield sender.send(new tl_1.Api.SetClientDHParams({
            nonce: resPQ.nonce,
            serverNonce: resPQ.serverNonce,
            encryptedData: clientDhEncrypted,
        }));
        const nonceTypes = [tl_1.Api.DhGenOk, tl_1.Api.DhGenRetry, tl_1.Api.DhGenFail];
        // TS being weird again.
        const nonceTypesString = ["DhGenOk", "DhGenRetry", "DhGenFail"];
        if (!(dhGen instanceof nonceTypes[0] ||
            dhGen instanceof nonceTypes[1] ||
            dhGen instanceof nonceTypes[2])) {
            throw new Error(`Step 3.1 answer was ${dhGen}`);
        }
        const { name } = dhGen.constructor;
        if (dhGen.nonce.neq(resPQ.nonce)) {
            throw new errors_1.SecurityError(`Step 3 invalid ${name} nonce from server`);
        }
        if (dhGen.serverNonce.neq(resPQ.serverNonce)) {
            throw new errors_1.SecurityError(`Step 3 invalid ${name} server nonce from server`);
        }
        const authKey = new AuthKey_1.AuthKey();
        yield authKey.setKey(__1.helpers.getByteArray(gab));
        const nonceNumber = 1 + nonceTypesString.indexOf(dhGen.className);
        const newNonceHash = yield authKey.calcNewNonceHash(newNonce, nonceNumber);
        // @ts-ignore
        const dhHash = dhGen[`newNonceHash${nonceNumber}`];
        if (dhHash.neq(newNonceHash)) {
            throw new errors_1.SecurityError("Step 3 invalid new nonce hash");
        }
        if (!(dhGen instanceof tl_1.Api.DhGenOk)) {
            throw new Error(`Step 3.2 answer was ${dhGen}`);
        }
        log.debug("Finished authKey generation step 3");
        return { authKey, timeOffset };
    });
}
exports.doAuthentication = doAuthentication;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aGVudGljYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2dyYW1qcy9uZXR3b3JrL0F1dGhlbnRpY2F0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7O0dBS0c7QUFDSCw4QkFBNEI7QUFDNUIsc0NBQTBDO0FBQzFDLHlEQUFzRDtBQUN0RCx1Q0FBb0M7QUFDcEMsOENBQTZDO0FBQzdDLCtDQUE0QztBQUM1QywyQkFBOEI7QUFDOUIsdUNBQXdDO0FBQ3hDLDhEQUFpQztBQUdqQyxTQUFzQixnQkFBZ0IsQ0FBQyxNQUEwQixFQUFFLEdBQVE7O1FBQ3ZFLDBFQUEwRTtRQUMxRSxJQUFJLEtBQUssR0FBRyxXQUFPLENBQUMsbUJBQW1CLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFNUMsTUFBTSxLQUFLLEdBQUcsV0FBTyxDQUFDLG9CQUFvQixDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDL0QsTUFBTSxLQUFLLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksUUFBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdEUsR0FBRyxDQUFDLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1FBRWhELElBQUksQ0FBQyxDQUFDLEtBQUssWUFBWSxRQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNqRDtRQUNELElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDeEIsTUFBTSxJQUFJLHNCQUFhLENBQUMsa0NBQWtDLENBQUMsQ0FBQztTQUMvRDtRQUNELE1BQU0sRUFBRSxHQUFHLFdBQU8sQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFF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