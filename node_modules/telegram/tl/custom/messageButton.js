"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessageButton = void 0;
const api_1 = require("../api");
const button_1 = require("./button");
const util_1 = require("util");
const Helpers_1 = require("../../Helpers");
class MessageButton {
    constructor(client, original, chat, bot, msgId) {
        this.button = original;
        this._bot = bot;
        this._chat = chat;
        this._msgId = msgId;
        this._client = client;
    }
    [util_1.inspect.custom]() {
        return Helpers_1.betterConsoleLog(this);
    }
    get client() {
        return this._client;
    }
    get text() {
        return !(this.button instanceof button_1.Button) ? this.button.text : "";
    }
    get data() {
        if (this.button instanceof api_1.Api.KeyboardButtonCallback) {
            return this.button.data;
        }
    }
    get inlineQuery() {
        if (this.button instanceof api_1.Api.KeyboardButtonSwitchInline) {
            return this.button.query;
        }
    }
    get url() {
        if (this.button instanceof api_1.Api.KeyboardButtonUrl) {
            return this.button.url;
        }
    }
    click({ sharePhone = false, shareGeo = [0, 0] }) {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.button instanceof api_1.Api.KeyboardButton) {
                return this._client.sendMessage(this._chat, {
                    message: this.button.text,
                    parseMode: undefined,
                });
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonCallback) {
                const request = new api_1.Api.messages.GetBotCallbackAnswer({
                    peer: this._chat,
                    msgId: this._msgId,
                    data: this.button.data,
                });
                try {
                    return yield this._client.invoke(request);
                }
                catch (e) {
                    if (e.errorMessage == "BOT_RESPONSE_TIMEOUT") {
                        return null;
                    }
                    throw e;
                }
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonSwitchInline) {
                return this._client.invoke(new api_1.Api.messages.StartBot({
                    bot: this._bot,
                    peer: this._chat,
                    startParam: this.button.query,
                }));
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonUrl) {
                return this.button.url;
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonGame) {
                const request = new api_1.Api.messages.GetBotCallbackAnswer({
                    peer: this._chat,
                    msgId: this._msgId,
                    game: true,
                });
                try {
                    return yield this._client.invoke(request);
                }
                catch (e) {
                    if (e.errorMessage == "BOT_RESPONSE_TIMEOUT") {
                        return null;
                    }
                    throw e;
                }
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonRequestPhone) {
                if (!sharePhone) {
                    throw new Error("cannot click on phone buttons unless sharePhone=true");
                }
                const me = (yield this._client.getMe());
                const phoneMedia = new api_1.Api.InputMediaContact({
                    phoneNumber: me.phone || "",
                    firstName: me.firstName || "",
                    lastName: me.lastName || "",
                    vcard: "",
                });
                throw new Error("Not supported for now");
                // TODO
                //return this._client.sendFile(this._chat, phoneMedia);
            }
            else if (this.button instanceof api_1.Api.InputWebFileGeoPointLocation) {
                if (!shareGeo) {
                    throw new Error("cannot click on geo buttons unless shareGeo=[longitude, latitude]");
                }
                let geoMedia = new api_1.Api.InputMediaGeoPoint({
                    geoPoint: new api_1.Api.InputGeoPoint({
                        lat: shareGeo[0],
                        long: shareGeo[1],
                    }),
                });
                throw new Error("Not supported for now");
                // TODO
                //return this._client.sendFile(this._chat, geoMedia);
            }
        });
    }
}
exports.MessageButton = MessageButton;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZUJ1dHRvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2dyYW1qcy90bC9jdXN0b20vbWVzc2FnZUJ1dHRvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFFQSxnQ0FBNkI7QUFDN0IscUNBQWtDO0FBQ2xDLCtCQUErQjtBQUMvQiwyQ0FBaUQ7QUFFakQsTUFBYSxhQUFhO0lBVXRCLFlBQ0ksTUFBc0IsRUFDdEIsUUFBb0IsRUFDcEIsSUFBZ0IsRUFDaEIsR0FBZSxFQUNmLEtBQW9CO1FBRXBCLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0lBQzFCLENBQUM7SUFoQkQsQ0FBQyxjQUFPLENBQUMsTUFBTSxDQUFDO1FBQ1osT0FBTywwQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBZ0JELElBQUksTUFBTTtRQUNOLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN4QixDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ0osT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sWUFBWSxlQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNwRSxDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ0osSUFBSSxJQUFJLENBQUMsTUFBTSxZQUFZLFNBQUcsQ0FBQyxzQkFBc0IsRUFBRTtZQUNuRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1NBQzNCO0lBQ0wsQ0FBQztJQUVELElBQUksV0FBVztRQUNYLElBQUksSUFBSSxDQUFDLE1BQU0sWUFBWSxTQUFHLENBQUMsMEJBQTBCLEVBQUU7WUFDdkQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztTQUM1QjtJQUNMLENBQUM7SUFFRCxJQUFJLEdBQUc7UUFDSCxJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksU0FBRyxDQUFDLGlCQUFpQixFQUFFO1lBQzlDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7U0FDMUI7SUFDTCxDQUFDO0lBRUssS0FBSyxDQUFDLEVBQUUsVUFBVSxHQUFHLEtBQUssRUFBRSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7O1lBQ2pELElBQUksSUFBSSxDQUFDLE1BQU0sWUFBWSxTQUFHLENBQUMsY0FBYyxFQUFFO2dCQUMzQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7b0JBQ3hDLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUk7b0JBQ3pCLFNBQVMsRUFBRSxTQUFTO2lCQUN2QixDQUFDLENBQUM7YUFDTjtpQkFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksU0FBRyxDQUFDLHNCQUFzQixFQUFFO2dCQUMxRCxNQUFNLE9BQU8sR0FBRyxJQUFJLFNBQUcsQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUM7b0JBQ2xELElBQUksRUFBRSxJQUFJLENBQUMsS0FBSztvQkFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNO29CQUNsQixJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJO2lCQUN6QixDQUFDLENBQUM7Z0JBQ0gsSUFBSTtvQkFDQSxPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzdDO2dCQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUNSLElBQUksQ0FBQyxDQUFDLFlBQVksSUFBSSxzQkFBc0IsRUFBRTt3QkFDMUMsT0FBTyxJQUFJLENBQUM7cUJBQ2Y7b0JBQ0QsTUFBTSxDQUFDLENBQUM7aUJBQ1g7YUFDSjtpQkFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksU0FBRyxDQUFDLDBCQUEwQixFQUFFO2dCQUM5RCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUN0QixJQUFJLFNBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO29CQUN0QixHQUFHLEVBQUUsSUFBSSxDQUFDLElBQUk7b0JBQ2QsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLO29CQUNoQixVQUFVLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLO2lCQUNoQyxDQUFDLENBQ0wsQ0FBQzthQUNMO2lCQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sWUFBWSxTQUFHLENBQUMsaUJBQWlCLEVBQUU7Z0JBQ3JELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDMUI7aUJBQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxZQUFZLFNBQUcsQ0FBQyxrQkFBa0IsRUFBRTtnQkFDdEQsTUFBTSxPQUFPLEdBQUcsSUFBSSxTQUFHLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDO29CQUNsRCxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUs7b0JBQ2hCLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTTtvQkFDbEIsSUFBSSxFQUFFLElBQUk7aUJBQ2IsQ0FBQyxDQUFDO2dCQUNILElBQUk7b0JBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUM3QztnQkFBQyxPQUFPLENBQUMsRUFBRTtvQkFDUixJQUFJLENBQUMsQ0FBQyxZQUFZLElBQUksc0JBQXNCLEVBQUU7d0JBQzFDLE9BQU8sSUFBSSxDQUFDO3FCQUNmO29CQUNELE1BQU0sQ0FBQyxDQUFDO2lCQUNYO2FBQ0o7aUJBQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxZQUFZLFNBQUcsQ0FBQywwQkFBMEIsRUFBRTtnQkFDOUQsSUFBSSxDQUFDLFVBQVUsRUFBRTtvQkFDYixNQUFNLElBQUksS0FBSyxDQUNYLHNEQUFzRCxDQUN6RCxDQUFDO2lCQUNMO2dCQUVELE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFhLENBQUM7Z0JBQ3BELE1BQU0sVUFBVSxHQUFHLElBQUksU0FBRyxDQUFDLGlCQUFpQixDQUFDO29CQUN6QyxXQUFXLEVBQUUsRUFBRSxDQUFDLEtBQUssSUFBSSxFQUFFO29CQUMzQixTQUFTLEVBQUUsRUFBRSxDQUFDLFNBQVMsSUFBSSxFQUFFO29CQUM3QixRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsSUFBSSxFQUFFO29CQUMzQixLQUFLLEVBQUUsRUFBRTtpQkFDWixDQUFDLENBQUM7Z0JBQ0gsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO2dCQUN6QyxPQUFPO2dCQUNQLHVEQUF1RDthQUMxRDtpQkFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksU0FBRyxDQUFDLDRCQUE0QixFQUFFO2dCQUNoRSxJQUFJLENBQUMsUUFBUSxFQUFFO29CQUNYLE1BQU0sSUFBSSxLQUFLLENBQ1gsbUVBQW1FLENBQ3RFLENBQUM7aUJBQ0w7Z0JBQ0QsSUFBSSxRQUFRLEdBQUcsSUFBSSxTQUFHLENBQUMsa0JBQWtCLENBQUM7b0JBQ3RDLFFBQVEsRUFBRSxJQUFJLFNBQUcsQ0FBQyxhQUFhLENBQUM7d0JBQzVCLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztxQkFDcEIsQ0FBQztpQkFDTCxDQUFDLENBQUM7Z0JBQ0gsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO2dCQUN6QyxPQUFPO2dCQUVQLHFEQUFxRDthQUN4RDtRQUNMLENBQUM7S0FBQTtDQUNKO0FBaklELHNDQWlJQyJ9